<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">-->

    <title>WoOx Travel - About Us</title>

    <!-- Bootstrap core CSS -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="/assets/css/fontawesome.css">
    <link rel="stylesheet" href="/assets/css/templatemo-woox-travel.css">
    <link rel="stylesheet" href="/assets/css/owl.css">
    <link rel="stylesheet" href="/assets/css/animate.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>
</head>
<body class="bodyBgc">
<header class="header-area header-sticky">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <!-- ***** Logo Start ***** -->
                    <a href="/index" class="logo">
                        <img src="/assets/images/logo.png" alt="">
                    </a>
                    <!-- ***** Logo End ***** -->
                    <!-- ***** Menu Start ***** -->
                    <ul class="nav">
                        <li>
                            <form action="/index"><input type="submit" value="主页"></form>
                        </li>
                        <li th:if="${cur.getRole() == 1}">
                            <form action="/orders"><input type="submit" value="审核"></form>
                        </li>
                        <li th:if="${cur.getRole() == 1}">
                            <form action="/publish"><input type="submit" value="发布"></form>
                        </li>
                        <li>
                            <form action="/myInfo"><input type="submit" value="我的"></form>
                        </li>
                        <!--            <li><a href="reservation.html">Book Yours</a></li>-->
                    </ul>
                    <a class='menu-trigger'>
                        <span>Menu</span>
                    </a>
                    <!-- ***** Menu End ***** -->
                </nav>
            </div>
        </div>
    </div>
</header>
<div class="infoShow" style="height: 1000px" id="app">
    <div class="infoBox ">

        <div class="row">
            <div class="col-12">
                <h2 class="text-muted col-title col-style">我的订单</h2>
                <ol class="olList" id="orderList">
                </ol>
            </div>
            <div class="col-12" style="margin-top: 30px" id="changePageUl">
                <!--        <ul class="page-numbers changePage">-->
                <!--          <li><a href="#"><i class="fa fa-arrow-left"></i></a></li>-->
                <!--          &lt;!&ndash;                  <li><a href="#">1</a></li>&ndash;&gt;-->
                <!--          <li class="active"><a href="#">2</a></li>-->
                <!--          &lt;!&ndash;                  <li><a href="#">3</a></li>&ndash;&gt;-->
                <!--          <li><a href="#"><i class="fa fa-arrow-right"></i></a></li>-->
                <!--        </ul>-->
            </div>
        </div>
    </div>
    <div class="infoBox ">
        <div class="row">
            <div class="col-12">
                <h2 class="text-muted col-title col-style">我的乘车</h2>
                <ol class="olList" id="carList">
                </ol>
            </div>
            <div class="col-12" style="margin-top: 30px" id="changePageUl1">
                <!--        <ul class="page-numbers changePage">-->
                <!--          <li><a href="#"><i class="fa fa-arrow-left"></i></a></li>-->
                <!--          &lt;!&ndash;                  <li><a href="#">1</a></li>&ndash;&gt;-->
                <!--          <li class="active"><a href="#">2</a></li>-->
                <!--          &lt;!&ndash;                  <li><a href="#">3</a></li>&ndash;&gt;-->
                <!--          <li><a href="#"><i class="fa fa-arrow-right"></i></a></li>-->
                <!--        </ul>-->
            </div>
        </div>
    </div>
    <div class="infoBox">
        <div class="row">
            <div class="col-12">
                <h2 class="text-muted col-title col-style">我的信息</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-muted">
                <form id="infoForm">
                    <div class="form-group col-style">
                        <label for="name">昵称</label>
                        <input placeholder="请输入用户名" id="name" name="name" type="text"
                               class="form-control validate border border-secondary" th:value="${cur.getUsername()}">
                    </div>
                    <div class="form-group col-style">
                        <label for="sex">性别</label>
                        <input placeholder="请输入性别(男/女)" id="sex" name="sex" type="text"
                               class="form-control validate border border-secondary" th:value="${cur.getSex()}">
                    </div>
                    <div class="form-group col-style">
                        <label for="phone">电话</label>
                        <input placeholder="010-030-0440" id="phone" name="phone" type="tel"
                               class="form-control validate border border-secondary" th:value="${cur.getMobile()}">
                    </div>
                    <div class="row col-style">
                        <div class="col-12 col-sm-5">
                            <fieldset>
                                <button class="btn btn-primary myButton border border-secondary" id="update"
                                        onclick="updateUser()">
                                    更新
                                </button>
                            </fieldset>

                        </div>
                        <div class="col-12 col-sm-5" style="text-align: right;margin-left: 45px">
                            <button class="btn btn-danger myButton border border-secondary"
                                    id="deleteAccount" onclick="clearForm()">清空
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
<script src="/vendor/jquery/jquery.min.js"></script>
<script src="/vendor/bootstrap/js/bootstrap.min.js"></script>

<script src="/assets/js/isotope.min.js"></script>
<script src="/assets/js/owl-carousel.js"></script>
<script src="/assets/js/wow.js"></script>
<script src="/assets/js/tabs.js"></script>
<script src="/assets/js/popup.js"></script>
<script src="/assets/js/custom.js"></script>

<script>
    $(".option").click(function () {
        $(".option").removeClass("active");
        $(this).addClass("active");
    });

    let finished = []
    let unFinished = []

    function getData() {
        $.ajax({
            url: '/user/allList',
            type: 'GET'
        }).then(res => {
            if (res.code === 200) {
                finished = res.data.finished;
                unFinished = res.data.unFinished;
                initOrderList()
            } else {
                alert('获取数据失败')
            }
        })
    }


    let pageNoOfOrder = 1
    let pageNoOfCar = 1
    let orderDestination = ["二号线", "六号线", "老校区", "二号线", "六号线", "老校区", "二号线", "六号线", "老校区"]
    let carDestination = ["二号线", "六号线", "老校区", "二号线", "六号线", "老校区", "二号线", "六号线", "老校区"]
    let orderTime = ["2023年4月1日", "2023年4月12日", "2023年6月1日", "2023年4月1日", "2023年4月12日", "2023年6月1日", "2023年4月1日", "2023年4月12日", "2023年6月1日"]
    let carTime = ["2023年4月1日", "2023年4月12日", "2023年6月1日", "2023年4月1日", "2023年4月12日", "2023年6月1日", "2023年4月1日", "2023年4月12日", "2023年6月1日"]
    $(function () {
        getData()
    })

    function clearForm() {
        document.getElementById('#infoForm').reset()
    }

    const editForm = {
        username: '',
        sex: '',
        mobile: ''
    };

    function updateUser() {
        editForm.username = document.getElementById('name').value
        editForm.sex = document.getElementById('sex').value
        editForm.mobile = document.getElementById('phone').value

        $.ajax({
            url: '/user/info',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify(editForm),
            success: function (res) {
                alert(res.message)
                console.log('更新成功')
            },
            fail: function (res) {
                console.log(res.message)
            }
        })
        // alert("修改成功！")
    }


    function initOrderList() {
        let end1 = 5 * pageNoOfOrder > finished.length ? finished.length : 5 * pageNoOfOrder
        console.log(end1)
        for (var i = (pageNoOfOrder - 1) * 5; i < end1; i++) {
            var li = document.createElement("li")
            li.innerHTML = `
        <a>
            <i>${finished[i].ending} </i> <i style="margin-left: 200px">${finished[i].startTime}</i>
          </a>
      `
            li.addEventListener("click", function () {

                // alert(${finished[i]})
                // document.location.href = encodeURI("./orderStatement")
            })
            document.querySelector("#orderList").appendChild(li)
        }

        var div1 = document.createElement("ul")
        div1.innerHTML = `<!--        <ul class="page-numbers changePage">-->
          <li onclick="frontOfOrder()"><a href="#"><i class="fa fa-arrow-left"></i></a></li>
          <!--                  <li><a href="#">1</a></li>-->
          <li class="active"><a href="#">${pageNoOfOrder}</a></li>
          <!--                  <li><a href="#">3</a></li>-->
          <li onclick="backOfOrder()"><a href="#"><i class="fa fa-arrow-right"></i></a></li>
<!--        </ul>-->
`
        div1.classList.add("page-numbers")
        div1.classList.add("changePage")
        document.querySelector("#changePageUl").append(div1)

        let end2 = 5 * pageNoOfCar > unFinished.length ? unFinished.length : 5 * pageNoOfCar
        for (var i = 5 * (pageNoOfCar - 1); i < end2; i++) {
            var li = document.createElement("li")
            li.innerHTML = `
        <a>
            <i>${unFinished[i].ending} </i> <i style="margin-left: 200px"> ${unFinished[i].startTime}</i>
          </a>
      `
            li.addEventListener("click", function () {
                // document.location.href = encodeURI("./orderStatement.html")
            })
            document.querySelector("#carList").appendChild(li)
        }

        var div2 = document.createElement("ul")
        div2.innerHTML = `<!--        <ul class="page-numbers changePage">-->
          <li onclick="frontOfCar()"><a href="#"><i class="fa fa-arrow-left"></i></a></li>
          <!--                  <li><a href="#">1</a></li>-->
          <li class="active"><a href="#">${pageNoOfCar}</a></li>
          <!--                  <li><a href="#">3</a></li>-->
          <li onclick="backOfCar()"><a href="#"><i class="fa fa-arrow-right"></i></a></li>
<!--        </ul>-->
`
        div2.classList.add("page-numbers")
        div2.classList.add("changePage")
        document.querySelector("#changePageUl1").appendChild(div2)
    }

    function frontOfOrder() {

        if (pageNoOfOrder === 1) {
            return
        }

        pageNoOfOrder -= 1
        removeAllEle("orderList")
        removeAllEle("changePageUl")
        removeAllEle("carList")
        removeAllEle("changePageUl1")
        initOrderList()
    }

    function frontOfCar() {
        if (pageNoOfCar === 1) {
            return
        }

        pageNoOfCar -= 1
        removeAllEle("orderList")
        removeAllEle("changePageUl")
        removeAllEle("carList")
        removeAllEle("changePageUl1")
        initOrderList()
    }

    function backOfOrder() {
        if ((pageNoOfOrder - 1) * 5 > finished.length) {
            return
        }
        pageNoOfOrder += 1
        removeAllEle("orderList")
        removeAllEle("changePageUl")
        removeAllEle("carList")
        removeAllEle("changePageUl1")
        initOrderList()
    }

    function backOfCar() {
        if ((pageNoOfCar - 1) * 5 > unFinished.length) {
            return
        }
        console.log(111)
        pageNoOfCar += 1
        removeAllEle("orderList")
        removeAllEle("changePageUl")
        removeAllEle("carList")
        removeAllEle("changePageUl1")
        initOrderList()
    }

    function removeAllEle(id) {
        let orderList = document.querySelector("#" + id)
        var child = orderList.lastElementChild
        while (child) {
            orderList.removeChild(child)
            child = orderList.lastElementChild
        }
    }


</script>
</html>